# W10-01: æƒé™ä¸RLSå›å½’ - æµ‹è¯•æ‰§è¡ŒæŒ‡å—

## ğŸ“‹ æ–‡æ¡£æ¦‚è¿°

æœ¬æ–‡æ¡£æä¾›W10-01å·¥å•çš„å®Œæ•´æµ‹è¯•æ‰§è¡ŒæŒ‡å—ï¼ŒåŒ…æ‹¬ï¼š
- å‰ç½®å‡†å¤‡å·¥ä½œ
- SQLæµ‹è¯•æ‰§è¡Œæ­¥éª¤
- å‰ç«¯è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œæ­¥éª¤
- æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤
- æµ‹è¯•ç»“æœè®°å½•æ¨¡æ¿

---

## ğŸ¯ æµ‹è¯•ç›®æ ‡

### P0éªŒæ”¶æ ‡å‡†
1. âœ… **è·¨è´¦å·æ•°æ®éš”ç¦»**: ç”¨æˆ·Aæ— æ³•è¯»å–/ä¿®æ”¹ç”¨æˆ·Bçš„æ•°æ®
2. âœ… **æœªç™»å½•è·¯ç”±ä¿æŠ¤**: æœªç™»å½•ç”¨æˆ·æ— æ³•è®¿é—®å­¦ä¹ åŒºï¼ˆ`/dashboard`ã€`/srs` ç­‰ï¼‰

### æµ‹è¯•èŒƒå›´
- **æ•°æ®åº“å±‚**: RLSç­–ç•¥éªŒè¯ï¼ˆ3ä¸ªè¡¨ï¼‰
- **åº”ç”¨å±‚**: Next.js middlewareè·¯ç”±ä¿æŠ¤
- **ç«¯åˆ°ç«¯**: Playwrightè‡ªåŠ¨åŒ–æµ‹è¯•

---

## ğŸ”§ å‰ç½®å‡†å¤‡

### 1. ç¯å¢ƒæ£€æŸ¥

```bash
# ç¡®è®¤Node.jsç‰ˆæœ¬
node --version  # åº”è¯¥ >= 18.x

# ç¡®è®¤ä¾èµ–å·²å®‰è£…
npm install

# ç¡®è®¤.env.localé…ç½®æ­£ç¡®
cat .env.local  # æ£€æŸ¥NEXT_PUBLIC_SUPABASE_URLå’ŒNEXT_PUBLIC_SUPABASE_ANON_KEY
```

### 2. åˆ›å»ºæµ‹è¯•ç”¨æˆ·

åœ¨Supabase Dashboardæˆ–é€šè¿‡åº”ç”¨çš„æ³¨å†ŒåŠŸèƒ½åˆ›å»ºä¸¤ä¸ªæµ‹è¯•ç”¨æˆ·ï¼š

```
ç”¨æˆ·A:
  - Email: test-user-a@example.com
  - Password: TestPassword123!

ç”¨æˆ·B:
  - Email: test-user-b@example.com
  - Password: TestPassword123!
```

**é‡è¦**: è®°å½•ä¸‹è¿™ä¸¤ä¸ªç”¨æˆ·çš„UUIDï¼ˆåœ¨Supabase Dashboardçš„Authenticationè¡¨ä¸­æŸ¥çœ‹ï¼‰

### 3. å¯åŠ¨åº”ç”¨

```bash
# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# éªŒè¯åº”ç”¨è¿è¡Œåœ¨ http://localhost:3000
```

### 4. å®‰è£…Playwrightï¼ˆå¦‚æœè¿è¡ŒE2Eæµ‹è¯•ï¼‰

```bash
# å®‰è£…PlaywrightåŠæµè§ˆå™¨
npm install -D @playwright/test
npx playwright install chromium
```

---

## ğŸ“Š æµ‹è¯•1: æ•°æ®åº“RLSç­–ç•¥éªŒè¯

### æ‰§è¡Œæ­¥éª¤

#### 1.1 æ‰“å¼€Supabase SQL Editor

1. è®¿é—® https://app.supabase.com
2. é€‰æ‹©ä½ çš„é¡¹ç›®
3. ç‚¹å‡»å·¦ä¾§èœå• **SQL Editor**

#### 1.2 å‡†å¤‡æµ‹è¯•è„šæœ¬

1. æ‰“å¼€ [`docs/W10-01-rls-test-script.sql`](W10-01-rls-test-script.sql)
2. æ›¿æ¢æ–‡ä»¶ä¸­çš„å ä½ç¬¦:
   - `:user_a_id` â†’ ç”¨æˆ·Açš„å®é™…UUID
   - `:user_b_id` â†’ ç”¨æˆ·Bçš„å®é™…UUID

ç¤ºä¾‹ï¼š
```sql
-- åŸå§‹:
-- \set user_a_id '123e4567-e89b-12d3-a456-426614174000'

-- æ›¿æ¢ä¸º:
\set user_a_id 'e8f9c2d1-3456-7890-abcd-ef1234567890'  -- å®é™…UUID
\set user_b_id 'f9a0b3e2-4567-8901-bcde-f01234567891'  -- å®é™…UUID
```

#### 1.3 é€æ®µæ‰§è¡Œæµ‹è¯•

**é‡è¦**: ä¸è¦ä¸€æ¬¡æ€§æ‰§è¡Œæ•´ä¸ªè„šæœ¬ã€‚æŒ‰åœºæ™¯é€æ®µæ‰§è¡Œï¼ŒéªŒè¯ç»“æœã€‚

##### åœºæ™¯1: user_saved_itemsè¡¨ RLSéªŒè¯

```sql
-- 1.1 å‡†å¤‡æµ‹è¯•æ•°æ®
-- æ‰§è¡Œè„šæœ¬ä¸­çš„"æµ‹è¯•åœºæ™¯1"ä¸‹çš„æ•°æ®å‡†å¤‡éƒ¨åˆ†
-- é¢„æœŸ: æˆåŠŸæ’å…¥5æ¡æµ‹è¯•æ•°æ®ï¼ˆ3æ¡ç”¨æˆ·Aï¼Œ2æ¡ç”¨æˆ·Bï¼‰

-- 1.2 éªŒè¯ç”¨æˆ·åªèƒ½æŸ¥çœ‹è‡ªå·±çš„æ”¶è—
-- æ‰§è¡ŒSELECTæŸ¥è¯¢
-- é¢„æœŸ: ç”¨æˆ·Açœ‹åˆ°3æ¡ï¼Œç”¨æˆ·Bçœ‹åˆ°0æ¡

-- 1.3 éªŒè¯INSERTæƒé™
-- é¢„æœŸ: ç”¨æˆ·Aå¯ä»¥åˆ›å»ºè‡ªå·±çš„æ”¶è—ï¼Œä½†æ— æ³•åˆ›å»ºå…¶ä»–ç”¨æˆ·çš„æ”¶è—

-- 1.4 éªŒè¯DELETEæƒé™
-- é¢„æœŸ: ç”¨æˆ·Aå¯ä»¥åˆ é™¤è‡ªå·±çš„ï¼Œä½†å½±å“0è¡Œå½“å°è¯•åˆ é™¤ç”¨æˆ·Bçš„
```

##### åœºæ™¯2: user_srs_cardsè¡¨ RLSéªŒè¯

```sql
-- 2.1-2.4 æ‰§è¡Œç±»ä¼¼çš„éªŒè¯æµç¨‹
-- å‚è€ƒSQLè„šæœ¬ä¸­çš„"æµ‹è¯•åœºæ™¯2"
```

##### åœºæ™¯3: user_srs_reviewsè¡¨ RLSéªŒè¯

```sql
-- 3.1-3.4 æ‰§è¡Œç±»ä¼¼çš„éªŒè¯æµç¨‹
-- å‚è€ƒSQLè„šæœ¬ä¸­çš„"æµ‹è¯•åœºæ™¯3"
-- ç‰¹åˆ«æ³¨æ„: éªŒè¯UPDATE/DELETEè¢«ç¦æ­¢
```

##### åœºæ™¯4: æœªç™»å½•ç”¨æˆ·éªŒè¯

```sql
-- 4.1 æ¨¡æ‹Ÿæœªç™»å½•çŠ¶æ€
-- é¢„æœŸ: æ‰€æœ‰æŸ¥è¯¢è¿”å›0è¡Œ
```

##### åœºæ™¯5: RLSé…ç½®éªŒè¯

```sql
-- éªŒè¯æ‰€æœ‰è¡¨å·²å¯ç”¨RLS
SELECT 
  schemaname,
  tablename,
  rowsecurity as rls_enabled
FROM pg_tables
WHERE tablename IN ('user_saved_items', 'user_srs_cards', 'user_srs_reviews')
ORDER BY tablename;

-- é¢„æœŸç»“æœ:
-- | schemaname | tablename           | rls_enabled |
-- |------------|---------------------|-------------|
-- | public     | user_saved_items    | true        |
-- | public     | user_srs_cards      | true        |
-- | public     | user_srs_reviews    | true        |
```

#### 1.4 è®°å½•ç»“æœ

åœ¨ [`docs/W10-01-security-acceptance-checklist.md`](W10-01-security-acceptance-checklist.md) ä¸­å¡«å†™ï¼š
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„å®é™…ç»“æœ
- æ ‡è®°é€šè¿‡/å¤±è´¥çŠ¶æ€
- è®°å½•ä»»ä½•å¼‚å¸¸æˆ–é—®é¢˜

---

## ğŸ¤– æµ‹è¯•2: Playwright E2Eè‡ªåŠ¨åŒ–æµ‹è¯•

### æ‰§è¡Œæ­¥éª¤

#### 2.1 è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰E2Eæµ‹è¯•
npx playwright test tests/e2e/W10-01-rls.spec.ts

# è¿è¡Œæµ‹è¯•å¹¶æ˜¾ç¤ºæµè§ˆå™¨ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
npx playwright test tests/e2e/W10-01-rls.spec.ts --headed

# è¿è¡Œç‰¹å®šæµ‹è¯•åœºæ™¯
npx playwright test tests/e2e/W10-01-rls.spec.ts --grep "æœªç™»å½•è®¿é—®ä¿æŠ¤"

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
npx playwright show-report
```

#### 2.2 æµ‹è¯•è¦†ç›–åœºæ™¯

è‡ªåŠ¨åŒ–æµ‹è¯•åŒ…å«ä»¥ä¸‹åœºæ™¯ï¼š

1. **æœªç™»å½•ç”¨æˆ·è®¿é—®ä¿æŠ¤**
   - éªŒè¯æ‰€æœ‰ä¿æŠ¤è·¯ç”±é‡å®šå‘åˆ° `/login`
   - éªŒè¯ `redirect` å‚æ•°æ­£ç¡®ä¼ é€’

2. **ç™»å½•åè‡ªåŠ¨é‡å®šå‘**
   - éªŒè¯ä» `/login?redirect=/dashboard` ç™»å½•åè·³è½¬åˆ° `/dashboard`
   - éªŒè¯ä» `/login?redirect=/srs` ç™»å½•åè·³è½¬åˆ° `/srs`

3. **å·²ç™»å½•ç”¨æˆ·è®¿é—®æ§åˆ¶**
   - éªŒè¯ç™»å½•åå¯ä»¥è®¿é—®æ‰€æœ‰å­¦ä¹ åŒº
   - éªŒè¯é¡µé¢æ­£å¸¸æ˜¾ç¤º

4. **ç”¨æˆ·æ•°æ®éš”ç¦»**ï¼ˆå‰ç«¯è§†è§’ï¼‰
   - éªŒè¯ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ®
   - éªŒè¯ç™»å‡ºåæ— æ³•è®¿é—®å­¦ä¹ åŒº

5. **è¾¹ç•Œæƒ…å†µ**
   - é˜²æ­¢å¼€æ”¾é‡å®šå‘æ¼æ´
   - å¹¶å‘ç™»å½•å¤„ç†
   - Sessionè¿‡æœŸå¤„ç†

#### 2.3 åˆ†ææµ‹è¯•ç»“æœ

```bash
# æµ‹è¯•å®Œæˆåï¼ŒæŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
npx playwright show-report

# æ£€æŸ¥å¤±è´¥æˆªå›¾ï¼ˆå¦‚æœæœ‰ï¼‰
ls playwright-report/

# æŸ¥çœ‹å¤±è´¥çš„æµ‹è¯•è¯¦æƒ…
cat playwright-report/results.json | grep -A 10 "\"status\": \"failed\""
```

#### 2.4 å¸¸è§é—®é¢˜æ’æŸ¥

##### é—®é¢˜1: æµ‹è¯•è¶…æ—¶

```bash
# åŸå› : åº”ç”¨å¯åŠ¨æ…¢æˆ–ç½‘ç»œæ…¢
# è§£å†³: å¢åŠ è¶…æ—¶æ—¶é—´æˆ–ç¡®ä¿åº”ç”¨å·²è¿è¡Œ
npm run dev  # æ‰‹åŠ¨å¯åŠ¨åº”ç”¨ï¼Œç„¶åè¿è¡Œæµ‹è¯•
npx playwright test --timeout=60000  # å¢åŠ è¶…æ—¶åˆ°60ç§’
```

##### é—®é¢˜2: ç™»å½•å¤±è´¥

```bash
# åŸå› : æµ‹è¯•ç”¨æˆ·ä¸å­˜åœ¨æˆ–å¯†ç é”™è¯¯
# è§£å†³: ç¡®è®¤æµ‹è¯•ç”¨æˆ·å·²åˆ›å»º
# åœ¨Supabase Dashboard â†’ Authentication â†’ Users ä¸­æ£€æŸ¥
```

##### é—®é¢˜3: é€‰æ‹©å™¨æ‰¾ä¸åˆ°å…ƒç´ 

```bash
# åŸå› : é¡µé¢ç»“æ„å˜åŒ–æˆ–åŠ è½½æœªå®Œæˆ
# è§£å†³: ä½¿ç”¨è°ƒè¯•æ¨¡å¼æŸ¥çœ‹å®é™…é¡µé¢
npx playwright test --headed --debug
```

---

## ğŸ‘¤ æµ‹è¯•3: æ‰‹åŠ¨æµ‹è¯•

### 3.1 æœªç™»å½•è®¿é—®å­¦ä¹ åŒº

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|-----|------|---------|---------|------|
| 1 | æ‰“å¼€æµè§ˆå™¨æ— ç—•æ¨¡å¼ | - | | |
| 2 | è®¿é—® `http://localhost:3000/dashboard` | é‡å®šå‘åˆ° `/login?redirect=/dashboard` | | â¬œ |
| 3 | è®¿é—® `http://localhost:3000/srs` | é‡å®šå‘åˆ° `/login?redirect=/srs` | | â¬œ |
| 4 | è®¿é—® `http://localhost:3000/grammar` | é‡å®šå‘åˆ° `/login?redirect=/grammar` | | â¬œ |
| 5 | è®¿é—® `http://localhost:3000/account` | é‡å®šå‘åˆ° `/login?redirect=/account` | | â¬œ |

### 3.2 ç™»å½•åè®¿é—®å­¦ä¹ åŒº

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|-----|------|---------|---------|------|
| 1 | ä½¿ç”¨ç”¨æˆ·Aç™»å½• | ç™»å½•æˆåŠŸ | | â¬œ |
| 2 | è®¿é—® `/dashboard` | é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œæ— é‡å®šå‘ | | â¬œ |
| 3 | è®¿é—® `/srs` | é¡µé¢æ­£å¸¸æ˜¾ç¤ºï¼Œæ— é‡å®šå‘ | | â¬œ |
| 4 | æ‰“å¼€å¼€å‘è€…å·¥å…· â†’ Network | - | | |
| 5 | åˆ·æ–° `/srs` é¡µé¢ | æŸ¥çœ‹Supabaseè¯·æ±‚ï¼Œç¡®è®¤åªæŸ¥è¯¢user_id=ç”¨æˆ·Açš„æ•°æ® | | â¬œ |
| 6 | ç™»å‡º | æˆåŠŸç™»å‡º | | â¬œ |
| 7 | åˆ·æ–°é¡µé¢ | é‡å®šå‘åˆ° `/login` | | â¬œ |

### 3.3 è·¨è´¦å·æ•°æ®éš”ç¦»

| æ­¥éª¤ | æ“ä½œ | é¢„æœŸç»“æœ | å®é™…ç»“æœ | çŠ¶æ€ |
|-----|------|---------|---------|------|
| 1 | ç”¨æˆ·Aç™»å½•ï¼Œæ·»åŠ SRSå¡ç‰‡ | æˆåŠŸæ·»åŠ  | | â¬œ |
| 2 | ç™»å‡ºç”¨æˆ·A | æˆåŠŸç™»å‡º | | â¬œ |
| 3 | ç”¨æˆ·Bç™»å½• | ç™»å½•æˆåŠŸ | | â¬œ |
| 4 | è®¿é—® `/srs` | ä¸æ˜¾ç¤ºç”¨æˆ·Açš„å¡ç‰‡ | | â¬œ |
| 5 | ç”¨æˆ·Bæ·»åŠ è‡ªå·±çš„SRSå¡ç‰‡ | æˆåŠŸæ·»åŠ  | | â¬œ |
| 6 | ç™»å‡ºç”¨æˆ·Bï¼Œé‡æ–°ç™»å½•ç”¨æˆ·A | æˆåŠŸåˆ‡æ¢ | | â¬œ |
| 7 | è®¿é—® `/srs` | ä¸æ˜¾ç¤ºç”¨æˆ·Bçš„å¡ç‰‡ï¼Œåªæ˜¾ç¤ºç”¨æˆ·Açš„ | | â¬œ |

---

## ğŸ“ æµ‹è¯•ç»“æœè®°å½•æ¨¡æ¿

### SQLæµ‹è¯•ç»“æœ

| åœºæ™¯ | æµ‹è¯•ç”¨ä¾‹ | é¢„æœŸ | å®é™… | çŠ¶æ€ | å¤‡æ³¨ |
|-----|---------|-----|------|------|------|
| user_saved_items | SELECTæƒé™ | ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„æ•°æ® | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_saved_items | INSERTæƒé™ | ç”¨æˆ·åªèƒ½åˆ›å»ºè‡ªå·±çš„æ•°æ® | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_saved_items | UPDATEæƒé™ | ç”¨æˆ·åªèƒ½æ›´æ–°è‡ªå·±çš„æ•°æ® | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_saved_items | DELETEæƒé™ | ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„æ•°æ® | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_cards | SELECTæƒé™ | ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„å¡ç‰‡ | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_cards | INSERTæƒé™ | ç”¨æˆ·åªèƒ½åˆ›å»ºè‡ªå·±çš„å¡ç‰‡ | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_cards | UPDATEæƒé™ | ç”¨æˆ·åªèƒ½æ›´æ–°è‡ªå·±çš„å¡ç‰‡ | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_cards | DELETEæƒé™ | ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„å¡ç‰‡ | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_reviews | SELECTæƒé™ | ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„è®°å½• | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_reviews | INSERTæƒé™ | ç”¨æˆ·åªèƒ½åˆ›å»ºè‡ªå·±çš„è®°å½• | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_reviews | UPDATEç¦æ­¢ | ä»»ä½•ç”¨æˆ·éƒ½æ— æ³•UPDATE | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| user_srs_reviews | DELETEç¦æ­¢ | ä»»ä½•ç”¨æˆ·éƒ½æ— æ³•DELETE | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| æœªç™»å½•çŠ¶æ€ | åŒ¿åæŸ¥è¯¢ | è¿”å›0è¡Œ | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| RLSé…ç½® | æ‰€æœ‰è¡¨å¯ç”¨RLS | rls_enabled=true | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |
| RLSé…ç½® | ç­–ç•¥ä½¿ç”¨auth.uid() | æ‰€æœ‰ç­–ç•¥æ­£ç¡®é…ç½® | | â¬œ é€šè¿‡ â¬œ å¤±è´¥ | |

### E2Eæµ‹è¯•ç»“æœ

```bash
# ç²˜è´´ Playwright æµ‹è¯•æŠ¥å‘Šæ‘˜è¦
# ä¾‹å¦‚:
# âœ“ 15 tests passed (30s)
# âœ— 2 tests failed (5s)
# âŠ˜ 1 test skipped

é€šè¿‡: ___ / ___
å¤±è´¥: ___ / ___
è·³è¿‡: ___ / ___
æ€»è€—æ—¶: ___ ç§’
```

### æ‰‹åŠ¨æµ‹è¯•ç»“æœ

| åœºæ™¯ | é€šè¿‡ | å¤±è´¥ | å¤‡æ³¨ |
|-----|------|------|------|
| æœªç™»å½•è®¿é—®å­¦ä¹ åŒº | â¬œ | â¬œ | |
| ç™»å½•åè®¿é—®å­¦ä¹ åŒº | â¬œ | â¬œ | |
| è·¨è´¦å·æ•°æ®éš”ç¦» | â¬œ | â¬œ | |

---

## ğŸ› é—®é¢˜è¿½è¸ª

### å‘ç°çš„é—®é¢˜åˆ—è¡¨

| ID | é—®é¢˜æè¿° | ä¸¥é‡æ€§ | å¤ç°æ­¥éª¤ | çŠ¶æ€ | è´Ÿè´£äºº |
|----|---------|-------|---------|------|-------|
| #1 | | P0/P1/P2 | | ğŸ”´å¾…ä¿®å¤ ğŸŸ¡è¿›è¡Œä¸­ ğŸŸ¢å·²ä¿®å¤ | |
| #2 | | | | | |

### é—®é¢˜è¯¦æƒ…æ¨¡æ¿

```markdown
#### é—®é¢˜ #1: [é—®é¢˜æ ‡é¢˜]

**ä¸¥é‡æ€§**: P0 / P1 / P2
**å‘ç°æ—¶é—´**: YYYY-MM-DD HH:MM
**å‘ç°è€…**: [å§“å]

**å¤ç°æ­¥éª¤**:
1. 
2. 
3. 

**é¢„æœŸè¡Œä¸º**:


**å®é™…è¡Œä¸º**:


**ç¯å¢ƒä¿¡æ¯**:
- OS: 
- Browser: 
- Nodeç‰ˆæœ¬: 

**æˆªå›¾/æ—¥å¿—**:


**è§£å†³æ–¹æ¡ˆ**ï¼ˆå¦‚æœå·²çŸ¥ï¼‰:

```

---

## âœ… éªŒæ”¶å†³ç­–

### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰SQL RLSæµ‹è¯•é€šè¿‡ï¼ˆ100%ï¼‰
- [ ] æ‰€æœ‰E2Eè‡ªåŠ¨åŒ–æµ‹è¯•é€šè¿‡ï¼ˆâ‰¥95%ï¼‰
- [ ] æ‰€æœ‰æ‰‹åŠ¨æµ‹è¯•é€šè¿‡ï¼ˆ100%ï¼‰
- [ ] æ— P0/P1çº§åˆ«çš„é—ç•™é—®é¢˜

### æœ€ç»ˆå†³ç­–

â¬œ **éªŒæ”¶é€šè¿‡** - æ»¡è¶³æ‰€æœ‰P0éªŒæ”¶æ ‡å‡†ï¼Œå·¥å•å¯ä»¥å…³é—­  
â¬œ **æ¡ä»¶é€šè¿‡** - åŸºæœ¬æ»¡è¶³è¦æ±‚ï¼Œä½†æœ‰å°‘é‡éå…³é”®é—®é¢˜éœ€è·Ÿè¿›  
â¬œ **éªŒæ”¶å¤±è´¥** - å­˜åœ¨å…³é”®é—®é¢˜ï¼Œéœ€è¦ä¿®å¤åé‡æ–°éªŒæ”¶

**å†³ç­–ç†ç”±**:


**ç­¾å­—**:
- æµ‹è¯•æ‰§è¡Œ: ___________ æ—¥æœŸ: __________
- æŠ€æœ¯è´Ÿè´£äºº: ___________ æ—¥æœŸ: __________
- äº§å“è´Ÿè´£äºº: ___________ æ—¥æœŸ: __________

---

## ğŸ“š é™„å½•

### A. ç›¸å…³æ–‡æ¡£é“¾æ¥

- [W4-01 æ•°æ®åº“Schema](W4-01-database-schema.sql)
- [W10-01 SQLæµ‹è¯•è„šæœ¬](W10-01-rls-test-script.sql)
- [W10-01 å®‰å…¨éªŒæ”¶æ¸…å•](W10-01-security-acceptance-checklist.md)
- [Playwrightæµ‹è¯•æ–‡ä»¶](../tests/e2e/W10-01-rls.spec.ts)
- [Middlewareé…ç½®](../middleware.ts)

### B. å¿«é€Ÿå‘½ä»¤å‚è€ƒ

```bash
# å¯åŠ¨åº”ç”¨
npm run dev

# è¿è¡ŒE2Eæµ‹è¯•
npx playwright test tests/e2e/W10-01-rls.spec.ts

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
npx playwright show-report

# è°ƒè¯•æ¨¡å¼è¿è¡Œæµ‹è¯•
npx playwright test --headed --debug

# åªè¿è¡Œç‰¹å®šæµ‹è¯•
npx playwright test --grep "æœªç™»å½•"
```

### C. Supabase RLSç›¸å…³èµ„æº

- [Supabase RLSæ–‡æ¡£](https://supabase.com/docs/guides/auth/row-level-security)
- [PostgreSQL RLSæ–‡æ¡£](https://www.postgresql.org/docs/current/ddl-rowsecurity.html)
- [auth.uid()å‡½æ•°è¯´æ˜](https://supabase.com/docs/guides/auth/row-level-security#helper-functions)

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-29  
**æœ€åæ›´æ–°**: 2026-01-29  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ

# 工单指令库（用户端 Web）全量版：Web 功能闭环（Learn Chinese Web）

## 你每次复制给 Kilo 的标准格式（强烈建议照抄）

> 把“工单正文”粘贴在最后。Kilo 看到这段前缀会更稳：

```text
/code
执行工单：<工单编号>：<工单标题>

重要说明：
- 你无法替我在网页控制台创建云资源（如 Supabase 项目）；需要时请在 docs 中给出“我手动操作”的步骤。
- 严格遵守本工单的【允许改动】白名单与【禁止改动】黑名单。
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容（摘要或片段）。
- 我确认后你再真正写入文件。
- 完成后给我：验收步骤（我在终端/浏览器如何验证）+ 建议 commit message。
```

---

## 全局约束（每张卡都默认继承）

- **UI 不推倒**：除非工单明确允许，否则不重构页面结构、不更换组件库、不大改样式。
- **小步提交**：每张卡完成后必须能 `npm/pnpm run dev`；`git status` 干净。
- **安全**：禁止把任何密钥写进仓库；`.env.local` 永远不提交。
- **优先 Server Actions**：优先使用 `actions/**` + Server Components 读数据；交互组件保持 Client。
- **数据隔离**：所有用户数据表必须有 `user_id` 并启用 RLS。
- **文档同步**：涉及新增表/动作/路由，需更新 `docs/FEATURE_COVERAGE.md`（若存在）或在 `docs/project-status.md` 记录。

---


> 工单设计：按“闭环切片”推进（每个切片都从 **内容发布 → Web 可见 → 收藏/SRS 可用 → SEO 可收录**）。  
> 依赖：Admin 端必须提供 `published` 内容写入与发布（见 Admin 工单库）。

---

## 0. 全局规则（必须执行）
1. Web 只读 `status='published'`
2. 所有数据访问必须经 Supabase + RLS（用户数据表）
3. SEO/GEO 必须写入每条内容详情页的实现工单验收里（不可遗漏）
4. 每条工单一个 commit；含验收步骤与截图/记录（你可以在 docs 里写）

---

## W0：基础设施与登录（Auth）

### W0-01：Supabase Client 封装 + env 校验（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：Web 端稳定初始化 supabase client，具备 session 获取能力  
**范围**：`lib/supabase/*`、env、基础错误提示  
**验收**：登录后 `getSession()` 有 user；缺 env 时有明确报错

### W0-02：OAuth 登录页 `/login`（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：Google/GitHub 登录可用，支持 redirect 回跳  
**验收**：未登录访问 `/app/dashboard` → 跳登录 → 登录成功回跳

### W0-03：学习区路由保护 `/app/*`（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：所有学习区必须登录  
**验收**：任意 `/app/*` 未登录均跳 `/login?redirect=...`

### W0-04：登出与会话保持（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：登出后会话失效，刷新不丢登录  
**验收**：登出后访问学习区再次要求登录

### W0-05：登录页 SEO noindex（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：`/login` head 中包含 `noindex,nofollow`

---

## W1：内容读取契约（Published Content API）

### W1-01：建立 Web 内容查询层（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：统一 `getContentList(type, filters)` 与 `getContentBySlug(type, slug)`  
**数据**：`content_items` 或分表（按你 DB 方案）  
**验收**：能查询 `medical_lexicon` 列表与详情（先挑一个 type 打通）

### W1-02：错误/空状态统一组件（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：列表与详情页统一 skeleton、error、empty  
**验收**：断网/无数据/403 都有清晰 UI

### W1-03：缓存策略（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：列表分页 + 详情缓存（SWR/Next cache）  
**验收**：重复访问不频繁请求；更新后能刷新

---

## W2：医疗内容 SEO 闭环（增长入口，强制先做）

### W2-01：医疗词汇（Lexicon）列表页接入 published（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：替换 mock → Supabase 读取 `medical_lexicon`  
**验收**：后台发布一条词条 → Web 列表可见

### W2-02：医疗词汇详情页（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：详情展示 term/pinyin/definition/usage/搭配/FAQ（按 seo_json）  
**SEO 验收**：title/description/canonical/OG + JSON-LD（FAQ/DefinedTerm 等）  
**功能验收**：可收藏、可加入 SRS

### W2-03：医疗场景 Scenario 列表 + 详情（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：读取 `medical_scenario` published 内容  
**SEO 验收**：详情页输出 HowTo/FAQ schema（取决于内容结构）  
**功能验收**：对话可读、关键短语可加入 SRS

### W2-04：医疗专题集合页（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：SEO landing（/medical、/medical/vocabulary、/medical/scenarios）  
**SEO 验收**：sitemap 可收录；面包屑；内部链接结构合理

---

## W3：词典与搜索（Dictionary）

### W3-01：全站搜索（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：支持 term/pinyin/英文搜索（先从 lexicon 起）  
**验收**：输入关键词能返回结果；无结果有引导

### W3-02：词典详情页（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：展示词条；加入收藏与 SRS  
**SEO 验收**：结构化数据（DefinedTerm/FAQ）

---

## W4：SRS 复习系统（必须闭环）

### W4-01：用户数据表接入（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：接入 `user_saved_items`、`user_srs_cards`、`user_srs_reviews`（RLS）  
**验收**：用户只能看到自己的数据；跨账号不可见

### W4-02：加入 SRS 的统一动作（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：在词条/短语/句子处统一“加入复习”按钮  
**验收**：加入后在 `/app/srs` 出现

### W4-03：复习队列与打分（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：今日到期卡片队列；认识/模糊/不认识更新间隔  
**验收**：重复复习后下一次到期时间变化符合规则

### W4-04：SRS 统计页（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：连续天数、正确率、总量  
**验收**：统计随 review 变化

---

## W5：Lessons/Readings/Grammar（主学习内容）

> 建议按“一个内容类型一个切片”推进，每个切片都包含：列表 → 详情 → 收藏/SRS → SEO。

### W5-01：Lessons 列表 + 详情（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：替换 mock → published lessons  
**验收**：后台发布 lesson → Web 可见；可收藏；词汇可加入 SRS  
**SEO**：详情页 schema（Article + Breadcrumb）

### W5-02：Readings 列表 + 详情（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：阅读内容接入；段落渲染；词典弹窗（P1）  
**SEO**：阅读详情页可收录

### W5-03：Grammar 列表 + 详情（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：语法点接入；例句可加入 SRS（句子卡）  
**SEO**：语法详情页可收录

### W5-04：学习进度（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：完成 lesson/reading 记录到 `user_progress`  
**验收**：dashboard 显示进度与推荐下一步

---

## W6：Dashboard 与推荐

### W6-01：学习总览 dashboard（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：展示：今日复习数、最近学习、推荐内容  
**验收**：与 SRS/进度联动

### W6-02：个性化推荐（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：基于等级/兴趣标签/最近行为推荐  
**验收**：推荐内容合理变化

---

## W7：Placement 分级测试（P1）

### W7-01：分级测试题库与答题（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：简化题库；输出等级  
**验收**：完成后写入 profile（level），dashboard 展示

---

## W8：多语言 i18n（P1）

### W8-01：营销区 i18n（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：至少中英；输出 hreflang  
**验收**：切换语言不丢 SEO 元信息

---

## W9：SEO/GEO 基建（必须）

### W9-01：自动 sitemap（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：按 published 内容生成 sitemap（按 type/locale）  
**验收**：sitemap 中包含医疗词条/场景/阅读等

### W9-02：robots.txt（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：屏蔽 `/login` 与学习区（按策略）  
**验收**：可访问 robots 且规则正确

### W9-03：结构化数据工具函数（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：统一生成 JSON-LD（FAQ/Breadcrumb/Article/DefinedTerm）  
**验收**：多个详情页复用同一函数

### W9-04：GEO 落地页（P1，若你需要）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**目标**：按 geo_json 生成城市/地区专题页  
**验收**：不同 city 的内容集合正确

---

## W10：上线前 QA（P0）

### W10-01：权限与 RLS 回归（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：跨账号不可读用户数据；未登录不可访问学习区

### W10-02：错误与边界（P0）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：断网、空数据、内容被下架（archived）时有正确提示

### W10-03：性能基线（P1）

**允许改动（白名单）**
- `app/**`
- `components/**`
- `lib/**`
- `actions/**`（若存在）
- `public/**`（仅新增静态资源）
- `docs/**`

**禁止改动（黑名单）**
- 不更换 UI 组件库/主题体系（shadcn/tailwind 保持不变）
- 不进行大规模重构（除非工单明确允许）
- 不提交 `.env*`、不把任何密钥写入仓库
- 不改动与本工单无关的路由/页面结构
- 不升级依赖大版本（除非工单明确要求）

**需要我手动操作时请写进 docs**
- 若需要我在 Supabase 控制台/SQL Editor/Authentication 设置里手动操作，请在 `docs/project-status.md`（或本项目 `docs/` 下新建同名文件）写清楚：入口路径、点击顺序、要粘贴的 SQL、预期看到的结果截图点位。

**交付要求**
- 先输出：计划（步骤）+ 将新增/修改的文件清单 + 每个文件将写入的关键内容摘要（或关键片段）。
- 我确认后再写入文件。
- 完成后给：验收步骤 + 建议 commit message。

**验收**：列表分页、图片懒加载、bundle 无明显爆炸
